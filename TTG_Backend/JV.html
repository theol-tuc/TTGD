<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Puzzle Solver</title>
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <style>
    #puzzle-board {
      width: 600px;
      height: 600px;
      margin: 0 auto;
      border: 1px solid #000;
    }
    .node {
      fill: lightblue;
      stroke: black;
      stroke-width: 1px;
    }
    .link {
      fill: none;
      stroke: #888;
      stroke-width: 2px;
    }
    .marble {
      fill: red;
      stroke: black;
      stroke-width: 1px;
    }
  </style>
</head>
<body>

  <h1>AI Puzzle Solver</h1>
  
  <!-- File Upload Form -->
  <form id="puzzle-form" enctype="multipart/form-data">
    <input type="file" name="file" accept=".gv" />
    <button type="submit">Upload and Solve Puzzle</button>
  </form>
  
  <div id="puzzle-board"></div>

  <script>
    // Handle form submission and send the uploaded file to the backend
    document.getElementById('puzzle-form').addEventListener('submit', function(event) {
      event.preventDefault();  // Prevent default form submission
      
      const formData = new FormData(this);
      
      fetch('http://localhost:5000/upload', {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        if (data.status === 'success') {
          console.log('Puzzle Solved:', data.plan);
          visualizeBoard(data.plan);  // Visualize the board with the AI's solution
        } else {
          console.error('Puzzle Upload Failed:', data.message);
        }
      })
      .catch(error => {
        console.error('Error:', error);
      });
    });

    // Visualize the puzzle board using D3.js
    function visualizeBoard(plan) {
      const width = 600;
      const height = 600;

      const svg = d3.select("#puzzle-board").append("svg")
        .attr("width", width)
        .attr("height", height);

      // Example puzzle components (nodes and edges)
      const nodes = [
        { id: 1, x: 100, y: 100 },
        { id: 2, x: 300, y: 100 },
        { id: 3, x: 500, y: 100 },
        { id: 4, x: 200, y: 300 },
        { id: 5, x: 400, y: 300 }
      ];

      const links = [
        { source: 1, target: 2 },
        { source: 2, target: 3 },
        { source: 3, target: 4 },
        { source: 4, target: 5 }
      ];

      // Add links (edges) between nodes
      svg.selectAll('.link')
        .data(links)
        .enter().append('line')
        .attr('class', 'link')
        .attr('x1', d => nodes[d.source - 1].x)
        .attr('y1', d => nodes[d.source - 1].y)
        .attr('x2', d => nodes[d.target - 1].x)
        .attr('y2', d => nodes[d.target - 1].y);

      // Add nodes (puzzle components)
      svg.selectAll('.node')
        .data(nodes)
        .enter().append('circle')
        .attr('class', 'node')
        .attr('r', 10)
        .attr('cx', d => d.x)
        .attr('cy', d => d.y);

      // Add marble path visualization (red dot for marble)
      const marblePath = [
        { x: 100, y: 100 },
        { x: 200, y: 300 },
        { x: 400, y: 300 }
      ];

      svg.selectAll('.marble')
        .data(marblePath)
        .enter().append('circle')
        .attr('class', 'marble')
        .attr('r', 5)
        .attr('cx', d => d.x)
        .attr('cy', d => d.y);
    }
  </script>

</body>
</html>
